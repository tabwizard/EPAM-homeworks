# EPAM [Lab] DevOps Internship #24

## Ansible Basics_Practice Task 2

Напишите плейбук для создания пользователей Alice, Bob, Carol. Для каждого пользователя нужно задать имя, адрес почты в комментарии (username@example.com), домашнюю папку, пароль в зашифрованном виде – в виде зашифрованной переменной или из отдельного шифрованного файла на выбор. Кроме пароля больше ничего шифровать не нужно. У уже созданных аккаунтов пароль менять не нужно.

**ОТВЕТ:** Создадим файл `vault-pass` с паролем для шифрования. Подготовим зашифрованный пароль пользователя:

```bash
$ python3 -c 'import crypt,getpass;print(crypt.crypt("my_password"))' | ansible-vault encrypt_string --vault-password-file vault-pass --stdin-name 'password'
Reading plaintext input from stdin. (ctrl-d to end input, twice if your content does not already have a newline)
password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          61633634653534633430646433356437316135313237653666323730356464333166613137316336
          3666306438326362643130646232363932376130663932340a363264343666326239393230616266
          64633661383063393766613734316161373964353962383661393134653063633063396639616465
          3639313164383336620a643065623431396433383734623837383339626465303536323364613137
          32333361373663316433373262373133613936383366306533626632306538333965646131663734
          62613939643432336138393635636332313831666234623765663936656532383437343761316133
          31393631666462653563333134353832343530653639396363383261643132313363623134626133
          30653239303362613666326261653034313836633633333463333534336166343437313538356330
          62393330396337303262376237346136353462633932656533323461643535303637

Encryption successful
```

Подготовим файл плейбука **[create_users.yml](./create_users.yml)**:

```yaml
---
- name: create users using a loop
  hosts: all
  tasks:
    - name: create users
      user:
        state: present
        name: "{{ item.name }}"
        home: "{{ item.home }}"
        comment: "{{ item.comment }}"
        password: "{{ item.password | password_hash('sha512') }}"
        update_password: on_create
      loop:
        - name: Alice
          home: /home/Alice
          comment: Alice@example.com
          password: !vault |
                $ANSIBLE_VAULT;1.1;AES256
                61633634653534633430646433356437316135313237653666323730356464333166613137316336
                3666306438326362643130646232363932376130663932340a363264343666326239393230616266
                64633661383063393766613734316161373964353962383661393134653063633063396639616465
                3639313164383336620a643065623431396433383734623837383339626465303536323364613137
                32333361373663316433373262373133613936383366306533626632306538333965646131663734
                62613939643432336138393635636332313831666234623765663936656532383437343761316133
                31393631666462653563333134353832343530653639396363383261643132313363623134626133
                30653239303362613666326261653034313836633633333463333534336166343437313538356330
                62393330396337303262376237346136353462633932656533323461643535303637
        - name: Bob
          home: /home/Bob
          comment: Bob@example.com
          password: !vault |
                $ANSIBLE_VAULT;1.1;AES256
                61633634653534633430646433356437316135313237653666323730356464333166613137316336
                3666306438326362643130646232363932376130663932340a363264343666326239393230616266
                64633661383063393766613734316161373964353962383661393134653063633063396639616465
                3639313164383336620a643065623431396433383734623837383339626465303536323364613137
                32333361373663316433373262373133613936383366306533626632306538333965646131663734
                62613939643432336138393635636332313831666234623765663936656532383437343761316133
                31393631666462653563333134353832343530653639396363383261643132313363623134626133
                30653239303362613666326261653034313836633633333463333534336166343437313538356330
                62393330396337303262376237346136353462633932656533323461643535303637
        - name: Carol
          home: /home/Carol
          comment: Carol@example.com
          password: !vault |
                $ANSIBLE_VAULT;1.1;AES256
                61633634653534633430646433356437316135313237653666323730356464333166613137316336
                3666306438326362643130646232363932376130663932340a363264343666326239393230616266
                64633661383063393766613734316161373964353962383661393134653063633063396639616465
                3639313164383336620a643065623431396433383734623837383339626465303536323364613137
                32333361373663316433373262373133613936383366306533626632306538333965646131663734
                62613939643432336138393635636332313831666234623765663936656532383437343761316133
                31393631666462653563333134353832343530653639396363383261643132313363623134626133
                30653239303362613666326261653034313836633633333463333534336166343437313538356330
                62393330396337303262376237346136353462633932656533323461643535303637
```

Запустим плейбук на выполнение командой:

```bash
ansible-playbook create_users.yml --vault-password-file vault-pass
```
